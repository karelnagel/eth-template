{"ast":null,"code":"/*\n\tISC License\n\n\tCopyright (c) 2019, Pierre-Louis Despaigne\n\n\tPermission to use, copy, modify, and/or distribute this software for any\n\tpurpose with or without fee is hereby granted, provided that the above\n\tcopyright notice and this permission notice appear in all copies.\n\n\tTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES\n\tWITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF\n\tMERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR\n\tANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES\n\tWHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN\n\tACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF\n\tOR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.\n*/\nconst CID = require('cids'); // Label's max length in DNS (https://tools.ietf.org/html/rfc1034#page-7)\n\n\nconst dnsLabelMaxLength = 63;\n/**\n * Take any ipfsHash and convert it to DNS-compatible CID\n * @param {string} ipfsHash a regular ipfs hash either a cid v0 or v1\n * @return {string} the resulting ipfs hash as a cid v1\n */\n\nconst cidForWeb = ipfsHash => {\n  let cid = new CID(ipfsHash);\n\n  if (cid.version === 0) {\n    cid = cid.toV1();\n  }\n\n  let dnsLabel = cid.toString('base32');\n\n  if (dnsLabel.length > dnsLabelMaxLength) {\n    const b36 = cid.toString('base36');\n\n    if (b36.length <= dnsLabelMaxLength) {\n      return b36;\n    }\n\n    throw new TypeError('CID is longer than DNS limit of 63 characters and is not compatible with public gateways');\n  }\n\n  return dnsLabel;\n};\n\nexports.cidForWeb = cidForWeb;\n/**\n * Take any ipfsHash and convert it to a CID v1 encoded in base32.\n * @param {string} ipfsHash a regular ipfs hash either a cid v0 or v1 (v1 will remain unchanged)\n * @return {string} the resulting ipfs hash as a cid v1\n */\n\nconst cidV0ToV1Base32 = ipfsHash => {\n  let cid = new CID(ipfsHash);\n\n  if (cid.version === 0) {\n    cid = cid.toV1();\n  }\n\n  return cid.toString('base32');\n};\n\nexports.cidV0ToV1Base32 = cidV0ToV1Base32;","map":{"version":3,"sources":["/Users/karel/Documents/eth/my-eth-app/node_modules/@ensdomains/content-hash/src/helpers.js"],"names":["CID","require","dnsLabelMaxLength","cidForWeb","ipfsHash","cid","version","toV1","dnsLabel","toString","length","b36","TypeError","exports","cidV0ToV1Base32"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,MAAMA,GAAG,GAAGC,OAAO,CAAC,MAAD,CAAnB,C,CAEA;;;AACA,MAAMC,iBAAiB,GAAG,EAA1B;AAEA;AACA;AACA;AACA;AACA;;AACA,MAAMC,SAAS,GAAIC,QAAD,IAAc;AAC/B,MAAIC,GAAG,GAAG,IAAIL,GAAJ,CAAQI,QAAR,CAAV;;AACA,MAAIC,GAAG,CAACC,OAAJ,KAAgB,CAApB,EAAuB;AACtBD,IAAAA,GAAG,GAAGA,GAAG,CAACE,IAAJ,EAAN;AACA;;AACA,MAAIC,QAAQ,GAAGH,GAAG,CAACI,QAAJ,CAAa,QAAb,CAAf;;AACA,MAAID,QAAQ,CAACE,MAAT,GAAkBR,iBAAtB,EAAyC;AACvC,UAAMS,GAAG,GAAGN,GAAG,CAACI,QAAJ,CAAa,QAAb,CAAZ;;AACA,QAAIE,GAAG,CAACD,MAAJ,IAAcR,iBAAlB,EAAqC;AACnC,aAAOS,GAAP;AACD;;AACD,UAAM,IAAIC,SAAJ,CAAe,0FAAf,CAAN;AACD;;AACF,SAAOJ,QAAP;AACA,CAdD;;AAgBAK,OAAO,CAACV,SAAR,GAAoBA,SAApB;AAGA;AACA;AACA;AACA;AACA;;AACA,MAAMW,eAAe,GAAIV,QAAD,IAAc;AACrC,MAAIC,GAAG,GAAG,IAAIL,GAAJ,CAAQI,QAAR,CAAV;;AACA,MAAIC,GAAG,CAACC,OAAJ,KAAgB,CAApB,EAAuB;AACtBD,IAAAA,GAAG,GAAGA,GAAG,CAACE,IAAJ,EAAN;AACA;;AACD,SAAOF,GAAG,CAACI,QAAJ,CAAa,QAAb,CAAP;AACA,CAND;;AAQAI,OAAO,CAACC,eAAR,GAA0BA,eAA1B","sourcesContent":["/*\n\tISC License\n\n\tCopyright (c) 2019, Pierre-Louis Despaigne\n\n\tPermission to use, copy, modify, and/or distribute this software for any\n\tpurpose with or without fee is hereby granted, provided that the above\n\tcopyright notice and this permission notice appear in all copies.\n\n\tTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES\n\tWITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF\n\tMERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR\n\tANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES\n\tWHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN\n\tACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF\n\tOR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.\n*/\n\nconst CID = require('cids');\n\n// Label's max length in DNS (https://tools.ietf.org/html/rfc1034#page-7)\nconst dnsLabelMaxLength = 63;\n\n/**\n * Take any ipfsHash and convert it to DNS-compatible CID\n * @param {string} ipfsHash a regular ipfs hash either a cid v0 or v1\n * @return {string} the resulting ipfs hash as a cid v1\n */\nconst cidForWeb = (ipfsHash) => {\n\tlet cid = new CID(ipfsHash);\n\tif (cid.version === 0) {\n\t\tcid = cid.toV1();\n\t}\n  let dnsLabel = cid.toString('base32');\n  if (dnsLabel.length > dnsLabelMaxLength) {\n    const b36 = cid.toString('base36');\n    if (b36.length <= dnsLabelMaxLength) {\n      return b36;\n    }\n    throw new TypeError ('CID is longer than DNS limit of 63 characters and is not compatible with public gateways');\n  }\n\treturn dnsLabel;\n}\n\nexports.cidForWeb = cidForWeb;\n\n\n/**\n * Take any ipfsHash and convert it to a CID v1 encoded in base32.\n * @param {string} ipfsHash a regular ipfs hash either a cid v0 or v1 (v1 will remain unchanged)\n * @return {string} the resulting ipfs hash as a cid v1\n */\nconst cidV0ToV1Base32 = (ipfsHash) => {\n\tlet cid = new CID(ipfsHash);\n\tif (cid.version === 0) {\n\t\tcid = cid.toV1();\n\t}\n\treturn cid.toString('base32');\n}\n\nexports.cidV0ToV1Base32 = cidV0ToV1Base32;\n"]},"metadata":{},"sourceType":"script"}